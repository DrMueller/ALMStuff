parameters:
  BuildConfiguration: ''
  SolutionName: ''

steps:
- task: DotNetCoreCLI@2
  displayName: Restore
  inputs:
    command: restore
    projects: '**/*.csproj'
    vstsFeed: '3c2d9c9a-d8f7-42f4-b7a3-dddf4064110a'

- task: DotNetCoreCLI@2
  displayName: 'Build with Warnings as Errors'
  inputs:
    projects: '**/*.csproj'
    arguments: '/p:TreatWarningsAsErrors="true" --configuration ${{ parameters.BuildConfiguration }}'

- powershell: |
   $path = Join-Path -Path $(Build.ArtifactStagingDirectory) -ChildPath "\JetBrains.ReSharper.CommandLineTools.2019.3.1\tools\"
   New-Item -Path "$path" -Name "Reports" -ItemType "directory"
  displayName: 'Create ReSharper Reports Path'
  enabled: false
   
- task: alanwales.resharper-code-analysis.custom-build-task.ResharperCli@2
  displayName: 'Run ReSharper analysis'
  inputs:
    solutionOrProjectPath: ${{ parameters.SolutionName }}

- task: DotNetCoreCLI@2
  displayName: Run Tests
  inputs:
    command: test
    projects: '**/*Tests/*.csproj'
    arguments: '--configuration ${{ parameters.BuildConfiguration }}'
